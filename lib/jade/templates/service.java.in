package de.rwth_aachen.awap.jade.generated;

import jade.domain.FIPAAgentManagement.Property;
import jade.domain.FIPAAgentManagement.ServiceDescription;
import de.rwth_aachen.awap.IServiceClient;
import de.rwth_aachen.awap.LocalService;

public class Service {
	public static ServiceDescription serviceToDescription(LocalService service) throws Exception {
		ServiceDescription sd = new ServiceDescription();

%% for service in services
	%% set type = "de.rwth_aachen.awap.service.local." ~ service.name
	%% if loop.first
		if(service instanceof {{ type }}) {
	%% else
		} else if(service instanceof {{ type }}) {
	%% endif
			sd.setType("{{ service.name }}");
			sd.setName("{{ service.name }}");
	%% if service.properties|length > 0
			{{ type }} pp = ({{ type }})service;
	%% endif
	%% for prop in service.properties
			{
		%% if prop.is_enum
				Object value = de.rwth_aachen.awap.jade.generated.Enum.{{ prop.enum_name | camelCase }}ToString(pp.{{ prop.name | camelCase }});
		%% else
				Object value = pp.{{ prop.name | camelCase }};
		%% endif
				sd.addProperties(new Property("{{ prop.name }}", value));
			}
	%% endfor
		}
%% endfor

		return sd;
	}

	public static ServiceDescription clientToDescription(IServiceClient client, de.rwth_aachen.awap.ServiceProperty... properties) throws Exception {
		ServiceDescription sd = new ServiceDescription();

%% for service in services
	%% set type = "de.rwth_aachen.awap.service.remote.I" ~ service.name ~ "Client"
	%% if loop.first
		if(client instanceof {{ type }}) {
	%% else
		} else if(client instanceof {{ type }}) {
	%% endif
			sd.setType("{{ service.name }}");
			// sd.setName("{{ service.name }}");
			for(de.rwth_aachen.awap.ServiceProperty prop : properties) {
				sd.addProperties({{ service.name | camelCase }}PropertyToJadeProperty(prop));
			}
		}
%% endfor

		return sd;
	}

%% for service in services
	public static Property {{ service.name | camelCase }}PropertyToJadeProperty(de.rwth_aachen.awap.ServiceProperty prop) throws Exception {
	%% for prop in service.properties
		%% set type = "de.rwth_aachen.awap.service.remote." ~ service.name ~ "." ~ prop.name ~ "Property"
		%% if loop.first
		if(prop instanceof {{ type }}) {
		%% else
		} else if(prop instanceof {{ type }}) {
		%% endif
			{{ type }} pp = ({{ type }})prop;
		%% if prop.is_enum
			Object value = de.rwth_aachen.awap.jade.generated.Enum.{{ prop.enum_name | camelCase }}ToString(pp.value);
		%% else
			Object value = pp.value;
		%% endif
			return new Property("{{ prop.name }}", value);
	%% endfor
		}
		throw new Exception("Invalid value for property of {{ service.name }}");
	}
%% endfor
}
